[gd_scene load_steps=13 format=3 uid="uid://b2vj6m7jldfcq"]

[ext_resource type="PackedScene" uid="uid://csg7h2gw70il0" path="res://player_car/car.tscn" id="1_4gxa1"]
[ext_resource type="PackedScene" uid="uid://wdk54g4eoif" path="res://road/road.tscn" id="2_i6rvc"]
[ext_resource type="Script" path="res://player_car/car.gd" id="5_8x4oh"]
[ext_resource type="Script" path="res://PauseTSB.gd" id="5_15ypm"]
[ext_resource type="PackedScene" uid="uid://dbermyk47ak70" path="res://obstacles/obstacles_generator.tscn" id="6_s2b05"]
[ext_resource type="Texture2D" uid="uid://cofacbm5grmy6" path="res://imgs/buttons/pause.png" id="7_2qo1l"]
[ext_resource type="FontFile" uid="uid://chflfac1g7d6v" path="res://fonts/VCR_OSD_MONO_1.001.ttf" id="7_c0mvp"]
[ext_resource type="PackedScene" uid="uid://cpt2foh0u5av1" path="res://scene/pause/pauseMenu.tscn" id="9_mlxa2"]

[sub_resource type="GDScript" id="GDScript_pc3e8"]
script/source = "extends Node

@onready var car = $Car
@onready var pause_menu = %PauseMenu

var paused = false

const VALUE_NEEDED_TO_CHANGE_ROAD = 32
const TIME_NEEDED_TO_CHANGE_ROAD = 1

var target_position_x: float = 0
var target_rotation: float = 0

var move_speed: float = 0
var rotate_speed: float = 0

func _ready():
	pass

func _process(delta):
	if Input.is_action_just_pressed(\"Pause\"):
		pauseManu()
	elif Input.is_action_just_pressed(\"MoveRight\") and car.position.x < 120:
		target_position_x = car.position.x + VALUE_NEEDED_TO_CHANGE_ROAD
		move_speed = (VALUE_NEEDED_TO_CHANGE_ROAD / TIME_NEEDED_TO_CHANGE_ROAD)
		target_rotation = 15
		rotate_speed = (15 / TIME_NEEDED_TO_CHANGE_ROAD)
	elif Input.is_action_just_pressed(\"MoveLeft\") and car.position.x > 62:
		target_position_x = car.position.x - VALUE_NEEDED_TO_CHANGE_ROAD
		move_speed = (VALUE_NEEDED_TO_CHANGE_ROAD / TIME_NEEDED_TO_CHANGE_ROAD)
		target_rotation = -15
		rotate_speed = (15 / TIME_NEEDED_TO_CHANGE_ROAD)

	if move_speed > 0:
		car.position.x = lerp(car.position.x, target_position_x, move_speed * delta)
		car.rotation_degrees = lerp(car.rotation_degrees, target_rotation, rotate_speed * delta)

		# Check if the car has reached the target rotation
		if abs(car.rotation_degrees - target_rotation) < 1.0:
			# Reset target rotation and position
			target_rotation = 0
			target_position_x = car.position.x  # You may need to adjust this depending on your game logic
			move_speed = (VALUE_NEEDED_TO_CHANGE_ROAD / TIME_NEEDED_TO_CHANGE_ROAD)  # Reset move speed as well

func pauseManu():
	if paused:
		pause_menu.hide()
		Engine.time_scale = 1
	else:
		pause_menu.show()
		Engine.time_scale = 0
	
	paused = !paused
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_uowd2"]
size = Vector2(165, 165)

[sub_resource type="GDScript" id="GDScript_i23qc"]
script/source = "extends Label

# Called when the node enters the scene tree for the first time.
func _ready():
	pass # Replace with function body.

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
	text= \"Score \"+str(int($\"../../Car\".point))
	pass
"

[sub_resource type="RectangleShape2D" id="RectangleShape2D_hqm6q"]

[node name="GameScene" type="Node"]
script = SubResource("GDScript_pc3e8")

[node name="Car" parent="." instance=ExtResource("1_4gxa1")]
unique_name_in_owner = true
position = Vector2(96, 199)
script = ExtResource("5_8x4oh")

[node name="Road" parent="." instance=ExtResource("2_i6rvc")]

[node name="PauseTSB" type="TouchScreenButton" parent="."]
position = Vector2(4, 4)
scale = Vector2(0.138, 0.138)
texture_normal = ExtResource("7_2qo1l")
texture_pressed = ExtResource("7_2qo1l")
shape = SubResource("RectangleShape2D_uowd2")
action = "Pause"
script = ExtResource("5_15ypm")

[node name="CanvasLayer" type="CanvasLayer" parent="."]

[node name="Label" type="Label" parent="CanvasLayer"]
offset_left = 72.0
offset_top = 1.0
offset_right = 158.0
offset_bottom = 24.0
theme_override_fonts/font = ExtResource("7_c0mvp")
theme_override_font_sizes/font_size = 11
text = "point 100"
horizontal_alignment = 2
vertical_alignment = 1
script = SubResource("GDScript_i23qc")

[node name="Control" type="Control" parent="."]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
size_flags_horizontal = 4

[node name="ToRightTSB" type="TouchScreenButton" parent="Control"]
position = Vector2(120, 120)
scale = Vector2(4, 12)
shape = SubResource("RectangleShape2D_hqm6q")
action = "MoveRight"

[node name="ToLeftTSB" type="TouchScreenButton" parent="Control"]
position = Vector2(40, 120)
scale = Vector2(4, 12)
shape = SubResource("RectangleShape2D_hqm6q")
action = "MoveLeft"

[node name="ObstaclesGenerator" parent="." instance=ExtResource("6_s2b05")]

[node name="PauseMenu" parent="." instance=ExtResource("9_mlxa2")]
unique_name_in_owner = true
visible = false
